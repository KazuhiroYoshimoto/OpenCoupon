

<script>
var img_id = parseInt(0);
function del_image(img_id){

	try {
		req = new ActiveXObject("Microsoft.XMLHTTP");
	} catch(e) {
		req = new XMLHttpRequest();
	}

	req.onreadystatechange = function()
	{
		var msg = document.getElementById("image_message");
		if (req.readyState == 4){
			if (req.status == 200){
				var data = req.responseText;
				//var data = req.responseXML;
				//var data = req.getAllResponseHeaders();
				console.log(data);
				//var result = data.getElementsByTagName('message');
				//console.log(result);


				//console.log(data);
				var result = eval( '(' + data + ')' );
				console.log(result);
				//msg.innerHTML = result.message;
				//removeElement($(img_id));
				//removeElement($(img_id+'_image'));
			} else {
				msg.innerHTML ="削除に失敗しました。";
			}
		} else {
			msg.innerHTML ="削除しています...";
		}
	}

	req.open("post", "./del_image/", true);
	req.setRequestHeader("content-type", "application/x-www-form-urlencoded;");
	req.send(encodeURI('to_delete='+img_id));

}
</script>


<div class="contents">
	<div class="hgroup1" style="font-size: 20px; border-bottom: 1px solid #D9D9D9; margin-top: 8px; padding-bottom: 13px;">
		<h1 style="font-size: 20px;">クーポン購入</h1>
	</div>
	<h2 style="border-bottom: 4px solid #B0D485; margin-bottom: 10px; padding-top: 13px; font-size: 20px;">購入内容</h2>
	<div id="coupon_content" style="padding-top:8px;">
		
		<?php $this->form()->Start('form_coupon','confirm') ?>
		<table>
			<tr>
				<?php /* タイトル */ ?>
				<td>
					<?php $this->form()->Label('coupon_title') ?>
				</td>
				<td>
					<?php $this->form()->Input('coupon_title') ?><br/>
					<?php $this->form()->Error('coupon_title') ?>
				</td>
			</tr>
			<tr>
				<?php /* 説明 */ ?>
				<td>
					<?php $this->form()->Label('coupon_description') ?>
				</td>
				<td>
					<?php $this->form()->Input('coupon_description') ?><br/>
					<?php $this->form()->Error('coupon_description') ?>
				</td>
			</tr>
			<tr>
				<?php /* 通常価格 */ ?>
				<td>
					<?php $this->form()->Label('coupon_normal_price') ?>
				</td>
				<td>
					<?php $this->form()->Input('coupon_normal_price') ?><br/>
					<?php $this->form()->Error('coupon_normal_price') ?>
				</td>
			</tr>
			<tr>
				<?php /* 販売価格 */ ?>
				<td>
					<?php $this->form()->Label('coupon_sales_price') ?>
				</td>
				<td>
					<?php $this->form()->Input('coupon_sales_price') ?><br/>
					<?php $this->form()->Error('coupon_sales_price') ?>
				</td>
			</tr>
			<tr>
				<?php /* 最大販売数 */ ?>
				<td>
					<?php $this->form()->Label('coupon_sales_num_top') ?>
				</td>
				<td>
					<?php $this->form()->Input('coupon_sales_num_top') ?><br/>
					<?php $this->form()->Error('coupon_sales_num_top') ?>
				</td>
			</tr>
			<tr>
				<?php /* 最小販売数 */ ?>
				<td>
					<?php $this->form()->Label('coupon_sales_num_bottom') ?>
				</td>
				<td>
					<?php $this->form()->Input('coupon_sales_num_bottom') ?><br/>
					<?php $this->form()->Error('coupon_sales_num_bottom') ?>
				</td>
			</tr>
			<tr>
				<?php /* 販売開始日時 */ ?>
				<td>
					<?php $this->form()->Label('coupon_sales_start') ?>
				</td>
				<td>
					<?php $this->form()->Input('coupon_sales_start') ?><br/>
					<?php $this->form()->Error('coupon_sales_start') ?>
				</td>
			</tr>
			<tr>
				<?php /* 終了開始日時 */ ?>
				<td>
					<?php $this->form()->Label('coupon_sales_finish') ?>
				</td>
				<td>
					<?php $this->form()->Input('coupon_sales_finish') ?><br/>
					<?php $this->form()->Error('coupon_sales_finish') ?>
				</td>
			</tr>
			<tr>
				<?php /* 有効期限 */ ?>
				<td>
					<?php $this->form()->Label('coupon_expire') ?>
				</td>
				<td>
					<?php $this->form()->Input('coupon_expire') ?><br/>
					<?php $this->form()->Error('coupon_expire') ?>
				</td>
			</tr>
			<tr>
				<?php /* 一人が購入できる枚数 */ ?>
				<td>
					<nobr><?php $this->form()->Label('coupon_person_num') ?></nobr>
				</td>
				<td>
					<?php $this->form()->Input('coupon_person_num') ?><br/>
					<?php $this->form()->Error('coupon_person_num') ?>
<!-- <input type="hidden" name="MAX_FILE_SIZE" value="2000000" >  -->
					</td>
			</tr>
			
			<?php /*
			<tr>
				<td>
					<?php $this->form()->Label('coupon_image') ?>
				</td>
				<td>
					<?php if( $path = $this->form()->GetInputValue('coupon_image') ): ?>
						<img src="<?=$path?>"/>
					<?php endif; ?>
					<?php $this->form()->Input('coupon_image') ?><br/>
					<?php $this->form()->Error('coupon_image') ?>
				</td>
			</tr>
			*/ ?>
			

<?php //$this->form()->Label('MAX_FILE_SIZE') ?>
<?php //$this->form()->Input('MAX_FILE_SIZE') ?>

<?php /*
<?php $row = 1; ?>
<?php while( $row <= 10 ): ?>
<?php $img_key = "coupon_image_".$row;?>
<?php print '<tr id="';?>
<?=$row?>
<?php if( $row >= 6 ):?>
<?php print '" style="display:none;';?>
<?php endif; ?>
<?php print '">';?>
<?php print '<td>';?>
<?php $this->form()->Label($img_key) ?>
<?php print '</td>';?>
<?php print '<td id="pv';?>
<?php print $row;?>
<?php print '">';?>
<?php //print '<img src="/img/noimage.jpg">';?>
<?php //print '<br/>';?>
<?php if( $path = $this->form()->GetInputValue($img_key) ): ?>
<?php print '<img src="';?>
<?=$path?>
<?php print '"/>';?>
<?php endif; ?>
<?php $this->form()->Input($img_key) ?>
<?php print '<br/>';?>
<?php $this->form()->Error($img_key) ?>
<?php print '<br/>';?>
<?php print '</td>';?>
<?php print '</tr>';?>
<?php $row++;?>
<?php endwhile; ?>
*/ ?>
			
			<?php /*?>
			<tr>
				<td></td>
				<td>
				<br>
				画像は最低 5 枚選択が必要です。<br>
				(オプションで最大 10 枚まで選択できます。)
				</td>
			</tr>
			*/ ?>
			
			</table>
			
		<?php /* ネガティブマージン用。要調整。
		<div style="width: 100%; height:100px;"></div>
		<div style="height:200px;"></div>
		*/ ?>
		
		<div style="text-align:center">
			<?php $this->form()->Input( 'submit', '　入力内容の確認　') ?>
		</div>
		<?php $this->form()->Finish('form_coupon') ?>
		

		<div>
		<form name="form_coupon_image" enctype="multipart/form-data" method="post" action="./upload/" target="targetFrame" id="form_coupon_image">
			<input type="hidden" name="MAX_FILE_SIZE" value="2000000" >
			<input type="file" name="upload_image" ><br>
			<input type="submit" value="画像をアップロード" >
		</form>
		</div>
		
		<div id="image_message">
		</div>
		
		<div id="uploaded_image">
		</div>
		
		<div id="result">
		<iframe id="targetFrame" src="" style="width:0px;height:0px;border:0px;"></iframe>
		</div>
		
		
		
		<?php /* ネガティブマージン用。要調整。
		<div style="width:100%;height:200px;margin-top:-300px;">
		<table>
		
		<?php $this->form()->Start('form_coupon_image') ?>

			<tr>
				<td>
					<?php $this->form()->Label('coupon_image_1') ?>
				</td>
				<td>
					<?php if( $path = $this->form()->GetInputValue('coupon_image_1') ): ?>
						<img src="<?=$path?>"/>
					<?php endif; ?>
					<?php $this->form()->Input('coupon_image_1') ?><br/>
					<?php $this->form()->Error('coupon_image_1') ?>
				</td>
			</tr>
		
		
		</table>
		</div>
		<div style="text-align:center">
		<?php $this->form()->Input( 'submit' ) ?>
		<?php $this->form()->Finish('form_coupon_image') ?>
		</div>
		*/ ?>
	</div>
</div>
